<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Info</title>
</head>
<body>
<h1>Favourite recipes and courses taken</h1>
<h2>User:</h2>
<h3 id="username"></h3>
<div class="info">
  <label for="usernameInput">Enter your username:</label>
  <input type="text" id="usernameInput">
  <input type="submit" onclick="setPageUsername()">
</div>
<div class="info">
    <label for="queryTable">Choose a field to query:</label>
    <select id="queryTable" name="queryTable">
        <option value="UsrFavouriteRecipe">favourite recipes</option>
        <option value="UsrTakeCourse">courses taken</option>
    </select>
    <input id="submit" type="submit" value="Query">
</div>
<table id="resultsTable" border="1px"></table>
<script>
  function setPageUsername() {
    document.getElementById("username").innerHTML = document.getElementById("usernameInput").value;
  }

  function createTable(jsonObjList) {
      if (jsonObjList == null || jsonObjList.length === 0) {return document.createElement("table");}
      let cols = [];
      for (let k in jsonObjList[0]){ cols.push(k);} // Push all keys to the array

      var table = document.createElement("table");

      // add header row
      var headerRow = table.insertRow(-1);
      for (var i = 0; i < cols.length; i++) {
          var theader = document.createElement("th"); // header cell
          theader.innerHTML = cols[i];
          headerRow.appendChild(theader); // Append columnName to the table row
      }

      // Adding the data to the table
      for (let i = 0; i < jsonObjList.length; i++) {
          tableRow = table.insertRow(-1);
          for (let j = 0; j < cols.length; j++) {
              let cell = tableRow.insertCell(-1);
              cell.innerHTML = jsonObjList[i][cols[j]];
          }
      }

      return table;
  }
</script>
<script>
  window.onclick = async function(event) {
      if (event.target.id === 'submit') {
          let username = document.getElementById("usernameInput").value;
          if (username==="" || username === null) {
              alert("Please enter a username.");
          }

          let queryTable = document.getElementById("queryTable").value;
          let requestBody = {
              "username": username,
              "table": queryTable
          };

          let response = await fetch('http://localhost:8080/getFavouritesOrCoursesByUsername',
              {
                  method: 'POST',
                  body: JSON.stringify(requestBody),
                  headers: {"Content-type": "application/json; charset=UTF-8"}
              });
          let responseJSON = await response.json();

          el = document.getElementById("resultsTable");
          el.innerHTML = "";
          el.appendChild(createTable(responseJSON));
      }
  }
</script>
</body>
</html>